@model Tuple<int, List<SanalDenemem.MvcWebUI.Entity.Question>>
@{
    ViewBag.Title = "ExamQuestion";
    Layout = "~/Views/Shared/_denemeLayout.cshtml";
}

<style>
    .group-question {
        padding: 2%;
        margin: 2%;
        border: 5px solid #bdc3c7;
        background-color: #bdc3c7;
    }

    .exam-title {
        width: 100%;
        color: #34495e;
        text-align: center;
    }

    .group-option {
        color: #ecf0f1;
        font-size: 2rem;
        margin: 1%;
        border: 2px solid #2980b9;
        background-color: #3498db;
        border-top-left-radius: 20px;
        border-top-right-radius: 20px;
        border-bottom-left-radius: 20px;
        border-bottom-right-radius: 20px;
    }

    body {
        background: url(http://subtlepatterns.subtlepatterns.netdna-cdn.com/patterns/wild_oliva.png);
    }

    .centered {
        margin: 50px auto;
        text-align: center;
    }

    .button::-moz-focus-inner {
        border: 0;
        padding: 0;
    }

    .button {
        display: inline-block;
        *display: inline;
        zoom: 1;
        padding: 6px 20px;
        margin: 0;
        cursor: pointer;
        border: 1px solid #bbb;
        overflow: visible;
        font: bold 13px arial, helvetica, sans-serif;
        text-decoration: none;
        white-space: nowrap;
        color: #555;
        background-color: #ddd;
        background-image: -webkit-gradient(linear, left top, left bottom, from(rgba(255,255,255,1)), to(rgba(255,255,255,0)));
        background-image: -webkit-linear-gradient(top, rgba(255,255,255,1), rgba(255,255,255,0));
        background-image: -moz-linear-gradient(top, rgba(255,255,255,1), rgba(255,255,255,0));
        background-image: -ms-linear-gradient(top, rgba(255,255,255,1), rgba(255,255,255,0));
        background-image: -o-linear-gradient(top, rgba(255,255,255,1), rgba(255,255,255,0));
        background-image: linear-gradient(top, rgba(255,255,255,1), rgba(255,255,255,0));
        -webkit-transition: background-color .2s ease-out;
        -moz-transition: background-color .2s ease-out;
        -ms-transition: background-color .2s ease-out;
        -o-transition: background-color .2s ease-out;
        transition: background-color .2s ease-out;
        background-clip: padding-box; /* Fix bleeding */
        -moz-border-radius: 3px;
        -webkit-border-radius: 3px;
        border-radius: 3px;
        -moz-box-shadow: 0 1px 0 rgba(0, 0, 0, .3), 0 2px 2px -1px rgba(0, 0, 0, .5), 0 1px 0 rgba(255, 255, 255, .3) inset;
        -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, .3), 0 2px 2px -1px rgba(0, 0, 0, .5), 0 1px 0 rgba(255, 255, 255, .3) inset;
        box-shadow: 0 1px 0 rgba(0, 0, 0, .3), 0 2px 2px -1px rgba(0, 0, 0, .5), 0 1px 0 rgba(255, 255, 255, .3) inset;
        text-shadow: 0 1px 0 rgba(255,255,255, .9);
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }



        .button.red:active {
            background: #e9e9e9;
            position: relative;
            top: 1px;
            text-shadow: none;
            -moz-box-shadow: 0 1px 1px rgba(0, 0, 0, .3) inset;
            -webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, .3) inset;
            box-shadow: 0 1px 1px rgba(0, 0, 0, .3) inset;
        }

        .button.blue:active {
            background: #e9e9e9;
        }

        .button[disabled], .button[disabled]:hover, .button[disabled]:active {
        }

        /* Smaller buttons styles */

        .button.small {
            padding: 4px 12px;
        }

        /* Larger buttons styles */

        .button.large {
            padding: 12px 30px;
            text-transform: uppercase;
        }

            .button.large:active {
                top: 2px;
            }

        /* Colored buttons styles */

        .button.green, .button.red, .button.blue {
            color: #fff;
            text-shadow: 0 1px 0 rgba(0,0,0,.2);
            background-image: -webkit-gradient(linear, left top, left bottom, from(rgba(255,255,255,.3)), to(rgba(255,255,255,0)));
            background-image: -webkit-linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
            background-image: -moz-linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
            background-image: -ms-linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
            background-image: -o-linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
            background-image: linear-gradient(top, rgba(255,255,255,.3), rgba(255,255,255,0));
        }

        /* */

        .button.green {
            background-color: #57a957;
            border-color: #57a957;
        }

            .button.green:hover {
                background-color: #62c462;
            }

            .button.green:active {
                background: #57a957;
            }

        /* */

        .button.red {
            background-color: #ca3535;
            border-color: #c43c35;
        }

            .button.red:hover {
                background-color: #ee5f5b;
            }

            .button.red:active {
                background: #c43c35;
            }

        /* */

        .button.blue {
            background-color: #269CE9;
            border-color: #269CE9;
        }



            .button.blue:active {
                background: #269CE9;
            }

    /* */

    .green[disabled], .green[disabled]:hover, .green[disabled]:active {
        border-color: #57A957;
        background: #57A957;
        color: #D2FFD2;
    }

    .red[disabled], .red[disabled]:hover, .red[disabled]:active {
        border-color: #C43C35;
        background: #C43C35;
        color: #FFD3D3;
    }

    .blue[disabled], .blue[disabled]:hover, .blue[disabled]:active {
    }

    /* Group buttons */

    .button-group,
    .button-group li {
        display: inline-block;
        *display: inline;
        zoom: 1;
    }

    .button-group {
        font-size: 0; /* Inline block elements gap - fix */
        margin: 0;
        padding: 0;
        background: rgba(0, 0, 0, .1);
        border-bottom: 1px solid rgba(0, 0, 0, .1);
        padding: 7px;
        -moz-border-radius: 7px;
        -webkit-border-radius: 7px;
        border-radius: 7px;
    }

        .button-group li {
            margin-right: -1px; /* Overlap each right button border */
        }

        .button-group .button {
            font-size: 13px; /* Set the font size, different from inherited 0 */
            -moz-border-radius: 0;
            -webkit-border-radius: 0;
            border-radius: 0;
        }

            .button-group .button:active {
                -moz-box-shadow: 0 0 1px rgba(0, 0, 0, .2) inset, 5px 0 5px -3px rgba(0, 0, 0, .2) inset, -5px 0 5px -3px rgba(0, 0, 0, .2) inset;
                -webkit-box-shadow: 0 0 1px rgba(0, 0, 0, .2) inset, 5px 0 5px -3px rgba(0, 0, 0, .2) inset, -5px 0 5px -3px rgba(0, 0, 0, .2) inset;
                box-shadow: 0 0 1px rgba(0, 0, 0, .2) inset, 5px 0 5px -3px rgba(0, 0, 0, .2) inset, -5px 0 5px -3px rgba(0, 0, 0, .2) inset;
            }

        .button-group li:first-child .button {
            -moz-border-radius: 3px 0 0 3px;
            -webkit-border-radius: 3px 0 0 3px;
            border-radius: 3px 0 0 3px;
        }

            .button-group li:first-child .button:active {
                -moz-box-shadow: 0 0 1px rgba(0, 0, 0, .2) inset, -5px 0 5px -3px rgba(0, 0, 0, .2) inset;
                -webkit-box-shadow: 0 0 1px rgba(0, 0, 0, .2) inset, -5px 0 5px -3px rgba(0, 0, 0, .2) inset;
                box-shadow: 0 0 1px rgba(0, 0, 0, .2) inset, -5px 0 5px -3px rgba(0, 0, 0, .2) inset;
            }

        .button-group li:last-child .button {
            -moz-border-radius: 0 3px 3px 0;
            -webkit-border-radius: 0 3px 3px 0;
            border-radius: 0 3px 3px 0;
        }

            .button-group li:last-child .button:active {
                -moz-box-shadow: 0 0 1px rgba(0, 0, 0, .2) inset, 5px 0 5px -3px rgba(0, 0, 0, .2) inset;
                -webkit-box-shadow: 0 0 1px rgba(0, 0, 0, .2) inset, 5px 0 5px -3px rgba(0, 0, 0, .2) inset;
                box-shadow: 0 0 1px rgba(0, 0, 0, .2) inset, 5px 0 5px -3px rgba(0, 0, 0, .2) inset;
            }
</style>
<style>


    /*.snippet-body {
         height: 100%
     }

    .snippet-body {

     }*/

    .modal-content.snippet-body {
        border-radius: 1rem;
        display: grid;
        place-items: center;
        width: 100%;
        height: 100vh;
        background-image: linear-gradient(to bottom right, rgb(10, 153, 209), rgb(5, 76, 122));
        text-align: center;
        font-size: 16px
    }

    .modal-content:hover.snippet-body {
        box-shadow: 2px 2px 2px black
    }

    .fa.snippet-body {
        color: #2b84be;
        font-size: 90px;
        padding: 30px 0px
    }

    .b1.snippet-body {
        background-color: #2b84be;
        box-shadow: 0px 4px #337095;
        font-size: 17px
    }

    .r3.snippet-body {
        color: #c1c1c1;
        font-weight: 500
    }

    a,
    a:hover.snippet-body {
        text-decoration: none
    }
</style>
<style>
    body {
        font-family: 'Varela Round', sans-serif;
    }

    .modal-confirm {
        color: #636363;
        width: 325px;
        font-size: 14px;
    }

        .modal-confirm .modal-content {
            padding: 20px;
            border-radius: 5px;
            border: none;
        }

        .modal-confirm .modal-header {
            border-bottom: none;
            position: relative;
        }

        .modal-confirm h4 {
            text-align: center;
            font-size: 26px;
            margin: 30px 0 -15px;
        }

        .modal-confirm .form-control, .modal-confirm .btn {
            min-height: 40px;
            border-radius: 3px;
        }

        .modal-confirm .close {
            position: absolute;
            top: -5px;
            right: -5px;
        }

        .modal-confirm .modal-footer {
            border: none;
            text-align: center;
            border-radius: 5px;
            font-size: 13px;
        }

        .modal-confirm .icon-box {
            color: #fff;
            position: absolute;
            margin: 0 auto;
            left: 0;
            right: 0;
            top: -70px;
            width: 95px;
            height: 95px;
            border-radius: 50%;
            z-index: 9;
            background: #82ce34;
            padding: 15px;
            text-align: center;
            box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.1);
        }

            .modal-confirm .icon-box i {
                font-size: 58px;
                position: relative;
                top: 3px;
            }

        .modal-confirm.modal-dialog {
            margin-top: 80px;
        }

        .modal-confirm .btn {
            color: #fff;
            border-radius: 4px;
            background: #82ce34;
            text-decoration: none;
            transition: all 0.4s;
            line-height: normal;
            border: none;
        }

            .modal-confirm .btn:hover, .modal-confirm .btn:focus {
                background: #6fb32b;
                outline: none;
            }

    .trigger-btn {
        display: inline-block;
        margin: 100px auto;
    }
</style>


<script>
    function startTimer(duration, display) {
        var timer = duration, minutes, seconds;
        setInterval(function () {
            minutes = parseInt(timer / 60, 10);
            seconds = parseInt(timer % 60, 10);

            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;
            if (display.textContent == "00:01") {
                finishExam();
                if(display.textContent == "00:00")pencereyiKapat();

            }
            display.textContent = minutes + ":" + seconds;

            if (--timer < 0) {
                timer = duration;
            }
        }, 1000);
    }

    //düzelteme yaptım
    window.onload = function () {
        var fiveMinutes = 60 * @Model.Item2.First().Exam.ExamTime,
            display = document.querySelector('#time');
        startTimer(fiveMinutes, display);
    };

    function pencereyiKapat() {
        window.open('', '_parent', '');
        window.close();
    }

    window.onbeforeunload = finishExam();
</script>

<link href='https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css' rel='stylesheet'>

<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
<script type='text/javascript' src='https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js'></script>
<script type='text/javascript' src='https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js'></script>
<script type='text/javascript'></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<div class="container" style="margin-top: 3%;">
    <div class="row">
        <div class="exam-title">
            <h1 style=" font-family:'Times New Roman';font-size:34px;">@Model.Item2.FirstOrDefault().Exam.Title</h1>

            <button style="position: fixed; z-index: 100; left: 80%; top: 10%; background-color: dodgerblue" class=" blue button" disabled><i class="icon-time"></i> Kalan Sınav Süresi: <span id="time"></span></button>
        </div>
    </div>
    <div class="col-md-12" style="margin: 2%;">
        @foreach (var item in Model.Item2)
        {
            <div class="card test-panel" style="margin-top: 2%;">

                <div class="card-header">
                    <h2>Soru: @item.RowNo</h2>
                </div>
                <div class="card-body">
                    @if (item.Image != null)
                    {
                        <div style="text-align: center;">
                            <img style="max-height: 400px; max-width: 100%; object-fit: cover;" src="~/Content/Uploads/Questions/@item.Image" />
                        </div>
                    }
                    <p style="font-size: 1.5rem; font-weight: 400; margin-top: 1%;">@item.Desc</p>
                    <p style="font-size: 2rem; font-weight: bold;">@item.Text</p>

                    <div class="col-md-12" style="padding: 0;">
                        <br>
                        @foreach (var opt in item.Options)
                        {
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text" style="font-size: 1.8rem !important;">
                                        <input name="@opt.QuestionId-ques" id="@opt.Id-opt" type="radio" class="ml-1" style="width: 1em; height: 1em;" onclick="sendAnswer(this)">

                                    </div>
                                </div>
                                <label for="@opt.QuestionId-ques" class="form-control test-option" style="font-size: 1.8rem !important; height: fit-content;">@opt.OptionText</label><br>
                            </div>
                            <br>
                        }
                        <div class="input-group">
                            <button onclick="emptyOption(@item.Id, @item.ExamId)" class=" red button">Boş Bırak</button>

                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
    <br />
    <br />
    <br />
    <br />
    <br />

    <button id="sinaviBitirBtn" class="large green button" href="#myModal" data-toggle="modal" style="position:relative;left: 50%;">Sınavı Bitir</button>
    <br />
    <br />
    <br />
    <br />
    <br />
    <br />

    @*<style>




        .social-container {
            width: 400px;
            text-align: center;
        }

        .social-icons {
            padding: 0;
            list-style: none;
            margin: 1em;
            li

        {
            display: inline;
            margin: 0.15em;
            position: relative;
            font-size: 1.2em;
        }

        i {
            color: #fff;
            position: absolute;
            top: 21px;
            left: 21px;
            transition: all $timing ease-out;
        }

        a {
            display: inline-block;
            &:before

        {
            content: " ";
            width: 60px;
            height: 60px;
            border-radius: 100%;
            display: block;
            background: linear-gradient(45deg, $iconColor, $accent);
            transition: all $timing ease-out;
        }

        &:hover:before {
            transform: scale(0);
            transition: all $timing ease-in;
        }

        &:hover i {
            color: $iconColor;
            background: -webkit-linear-gradient(45deg, $iconColor, $accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            transition: all $timing ease-in;
        }

        }
        }
    </style>*@

    <!-- Modal HTML -->
    <div id="myModal" class="modal fade">
        <div class="modal-dialog modal-confirm">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="icon-box">
                        <i class="fa icon-message"></i>
                    </div>
                    <h4 class="modal-title w-100">Harikasın !</h4>
                </div>
                <div class="modal-body">
                    <p class="text-center">Sosyal medya platformlarımızı takip ederek gelişmelerden erken haberdar olabilirsiniz.</p>
                </div>
                <div class="social-container" style="align-self:center; margin:20px; color:greenyellow; border:1px black;box-shadow: 5px 8px 8px 10px #888888; border-radius:25px; background-color:lightgray;">
                    <ul class="social-icons" style="display:inline; font-size:45px; text-align:center; position:center; color:greenyellow;">
                        <li style="display:inline; padding:10px;"><a href="https://www.facebook.com/sanaldenemem/"><i class="fa fa-facebook fa-lg"></i></a></li>
                        <li style="display:inline; padding:10px;"><a href="https://twitter.com/sanaldenemem"><i class="fa fa-instagram" style="color:orangered;"></i></a></li>
                        <li style="display:inline; padding:10px;"><a href="https://www.instagram.com/sanaldenemem/"><i class="fa fa-twitter"></i></a></li>
                        <li style="display:inline; padding:10px;"><a href="https://www.youtube.com/channel/UC7cg94tTqM5S3W6kIt3wr7Q"><i class="fa fa-youtube-play" style="color:red;"></i></a></li>

                    </ul>
                </div>
                <div class="modal-footer">
                    <button onclick="finishExam()" class="btn btn-success btn-block" data-dismiss="modal" style="font-size:18px;">Tamam</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let dizi = [];

    function sendAnswer(e) {
    console.log(dizi);

        var arr = window.location.href.split('/');
        var data = {
            examId: parseInt(arr[arr.length - 1]),
            quesId: parseInt(e.name.split('--')[0].split('-')[0]),
            optId: parseInt(e.id.split('-')[0]),
            memberId: parseInt(@Model.Item1)
        };
        for (var i = 0; i < dizi.length; i++) {
            if (dizi[i].examId == data.examId && dizi[i].quesId == data.quesId) {
                dizi.splice(i, 1);
            }
        }
        dizi.push(data);
    }

    let isFinish = false;
    function finishExam() {
    $('#sinaviBitirBtn').prop('disabled', true);
    console.log(dizi);
    if(isFinish != true){
        if(dizi.length != 0){
		  $.ajax({
			type: 'POST',
			url: '@Url.Action("ExamResult", "Home", new { area = "" })',
            data: { dizi: dizi},
            //contenttype: "application/json; charset=utf-8",
            //datatype: "json",
            //traditional : true,
			success: function (response) {
              console.log(response);
			  window.location.href = '@Url.Action("Profile", "Members", new { area = "" })';
			  console.log("basarılı.");
			},
            error: function (err) {
                alert(err);
            }
        });
        }
        else{alert("Tüm sorular boş bırakılamaz.");}
    }
    else{alert("Sınav zaten bitti.");}
    }

    function emptyOption(quesId, examId, point) {
    console.log(dizi);
        $('input[name=' + quesId + '-ques]').attr('checked', false);
        var data = {
            examId: parseInt(examId),
            quesId: parseInt(quesId),
            optId: 0,
            memberId: parseInt(@Model.Item1)
        };
        for (var i = 0; i < dizi.length; i++) {
            if (dizi[i].examId == examId && dizi[i].quesId == quesId) {
                dizi.splice(i, 1);
                return;
            }
        }
        dizi.push(data);
    }
</script>